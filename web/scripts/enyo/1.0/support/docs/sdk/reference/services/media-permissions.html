<!DOCTYPE html>
<html>
	<head>
		<title>$if(pagetitle)$$pagetitle$$endif$</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="_css/chrome.css" />
		<link rel="stylesheet" href="../_css/chrome.css" />
		<link rel="stylesheet" href="../../_css/chrome.css" />
		<link rel="stylesheet" href="../../../_css/chrome.css" />
		<script src="_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="_js/doc.js" type="text/javascript"></script>
		<script src="../_js/doc.js" type="text/javascript"></script>
		<script src="../../_js/doc.js" type="text/javascript"></script>
		<script src="../../../_js/doc.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="content">
    
    <h1 id="media-permissions">
      Media Permissions
    </h1>
    <p>
      Unless you are the owner, the db8 service, by default, denies application and service access to all stored data objects. Read-only access to db8 data is granted through the &quot;com.palm.mediapermissions&quot; service. Currently, this service provides the following API.
    </p>
    <h2 id="request">
      request
    </h2>
    <p>
      Your app can use this API to request access to one or more db8 kinds and their stored data objects. If the caller is new to the media permissions service, a dialog box is displayed to the user asking if access is ok for this app. Once the user responds, the caller is notified with the verdict - either the app has complete access or none at all. At the moment, it is not possible for the user to grant limited or partial access or deny. The response is then stored in the database for future reference. This cached response is used in case repeated requests for access are made so the user is not disturbed.
    </p>
    <p>
      Note that granted permissions can become invalid after inactivity or application removal. There is no guaranteed permissions duration, though it is unlikely permissions would be revoked immediately after being granted. A typical solution is to attempt access during application start and, if denied, make a request call to prompt the user before continuing.
    </p>
    <h3 id="schema">
      Schema
    </h3>
    <pre>
<code>{
   &quot;rights&quot;: {  
                &quot;read&quot;: string array  
             }
}
</code>
</pre>
    <h3 id="elements">
      Elements
    </h3>
    <table border="1">
      <thead>
        <tr>
          <th>
            Element
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            rights
          </td>
          <td>
            Yes
          </td>
          <td>
            inline object
          </td>
          <td>
            See element below
          </td>
        </tr>
        <tr bgcolor="blanchedAlmond">
          <td>
            rights.read
          </td>
          <td>
            Yes
          </td>
          <td>
            string array
          </td>
          <td>
            db8 kinds you want read-only access for
          </td>
        </tr>
      </tbody>
    </table>
    <h3 id="returns">
      Returns
    </h3>
    <pre>
<code>{
    &quot;returnValue&quot; : boolean,
    &quot;isAllowed&quot;   : boolean,  
    &quot;reason&quot;      : string
} 
</code>
</pre>
    <h3 id="elements-1">
      Elements
    </h3>
    <table border="1">
      <thead>
        <tr>
          <th>
            Element
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            Service call success (true) or failure (false)
          </td>
        </tr>
        <tr>
          <td>
            isAllowed
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            If true, rights are granted.
          </td>
        </tr>
        <tr>
          <td>
            reason
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            If &quot;isAllowed&quot; is false, reason for denial.
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      <strong>Example</strong>
    </p>
    <pre>
<code>var self = this;  
var imageKind = &quot;com.palm.media.image.file:1&quot;; 
var albumKind = &quot;com.palm.media.image.album:1&quot;; 
function requestPermission(done) { 
     self.controller.serviceRequest('palm://com.palm.mediapermissions', {  
        method: 'request',  
        parameters: {  
            rights: {  
                read: [imageKind, albumKind]  
            }  
        },  
        onComplete: function(response) {  
            if (response.returnValue &amp;&amp; response.isAllowed) {  
               Mojo.Log.info('Got permissions okay!');
                           done();   
            } else {  
                Mojo.Log.error('Failed to get permissions!');  
            }  
        }  
    });
}

function checkPermissions(done) {  
    self.controller.serviceRequest('palm://com.palm.db', {  
        method: 'find',  
        parameters: {  
            query: {  
                from: imageKind,  
                limit: 1 
            }  
        },  
        onSuccess: function() {  
            Mojo.Log.info('We have permissions.');  
            done();  
        },  
        onFailure: function() {  
            Mojo.Log.info('We do not have permission, asking.');  
            requestPermission(done);  
        }  
    });  
}  

checkPermissions(function continueToRunApp() {  
    // we're running good now!  
});
</code>
</pre>
		</div>
	</body>
</html>